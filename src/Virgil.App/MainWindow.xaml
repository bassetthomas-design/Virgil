<Window x:Class="Virgil.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:controls="clr-namespace:Virgil.App.Controls"
        mc:Ignorable="d"
        Title="Virgil"
        Width="1280"
        Height="760"
        Background="#0E1116"
        Foreground="White"
        WindowStartupLocation="CenterScreen">

  <Grid>
    <!-- =========================
         BARRE SUPÉRIEURE
         ========================= -->
    <DockPanel LastChildFill="False" Height="44" Background="#1A1D24">
      <TextBlock x:Name="ClockText"
                 Text="--:--:--"
                 DockPanel.Dock="Left"
                 VerticalAlignment="Center"
                 Margin="16,0,0,0"
                 FontSize="16"
                 FontWeight="SemiBold"/>
      <ToggleButton x:Name="SurveillanceToggle"
                    Content="Démarrer la surveillance"
                    DockPanel.Dock="Right"
                    Margin="0,0,16,0"
                    Padding="12,4"
                    VerticalAlignment="Center"
                    Checked="SurveillanceToggle_Checked"
                    Unchecked="SurveillanceToggle_Unchecked"/>
    </DockPanel>

    <!-- =========================
         CONTENU PRINCIPAL
         ========================= -->
    <Grid Margin="0,44,0,0">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="280"/>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="420"/>
      </Grid.ColumnDefinitions>

      <!-- Panneau gauche (avatar + stats) -->
      <Border Grid.Column="0" Background="#15191F" Padding="16">
        <StackPanel>
          <controls:VirgilAvatar x:Name="Avatar" Width="200" Height="200" HorizontalAlignment="Center"/>

          <Border BorderBrush="#2A2F36" BorderThickness="1" Margin="0,16,0,0" Padding="12">
            <StackPanel>
              <TextBlock Text="Surveillance" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,6"/>
              <TextBlock Text="CPU" FontSize="12"/>
              <ProgressBar x:Name="CpuBar" Height="10" Maximum="100" Value="0" />
              <TextBlock x:Name="CpuTempText" Text="CPU: -- °C" FontSize="11" Opacity="0.75" Margin="0,2,0,8"/>

              <TextBlock Text="GPU" FontSize="12"/>
              <ProgressBar x:Name="GpuBar" Height="10" Maximum="100" Value="0" />
              <TextBlock x:Name="GpuTempText" Text="GPU: -- °C" FontSize="11" Opacity="0.75" Margin="0,2,0,8"/>

              <TextBlock Text="Mémoire" FontSize="12"/>
              <ProgressBar x:Name="RamBar" Height="10" Maximum="100" Value="0" />
              <TextBlock x:Name="RamText" Text="RAM: -- / --" FontSize="11" Opacity="0.75" Margin="0,2,0,8"/>

              <TextBlock Text="Disque" FontSize="12"/>
              <ProgressBar x:Name="DiskBar" Height="10" Maximum="100" Value="0" />
              <TextBlock x:Name="DiskTempText" Text="Disque: -- °C" FontSize="11" Opacity="0.75" Margin="0,2,0,0"/>
            </StackPanel>
          </Border>

          <!-- Seuils -->
          <Border BorderBrush="#2A2F36" BorderThickness="1" Margin="0,12,0,0" Padding="12">
            <StackPanel>
              <TextBlock Text="Seuils (fusion machine + user)" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,6"/>
              <TextBlock x:Name="ThresholdsText" Text="Chargement..." FontSize="11" Opacity="0.9" TextWrapping="Wrap"/>
              <Button x:Name="OpenConfigButton" Content="Ouvrir config" Margin="0,8,0,0" Click="OpenConfig_Click"/>
            </StackPanel>
          </Border>
        </StackPanel>
      </Border>

      <!-- Zone centrale (chat) -->
      <DockPanel Grid.Column="1" Background="#0E1116" LastChildFill="True">
        <ScrollViewer x:Name="ChatScroll" VerticalScrollBarVisibility="Auto">
          <ItemsControl x:Name="ChatList">
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <Border CornerRadius="6" Padding="8" Margin="6"
                        Background="{Binding BubbleBrush}">
                  <StackPanel>
                    <TextBlock Text="{Binding Text}" TextWrapping="Wrap"/>
                    <TextBlock Text="{Binding Time}" FontSize="10" Opacity="0.7" HorizontalAlignment="Right"/>
                  </StackPanel>
                </Border>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </ScrollViewer>
      </DockPanel>

      <!-- Panneau droit (actions + statut) -->
      <Border Grid.Column="2" Background="#15191F" Padding="12">
        <StackPanel>
          <!-- ======== BOUTONS D’ACTION ======== -->
          <GroupBox Header="Actions" Foreground="White" BorderBrush="#2A2F36" Margin="0,8,0,0">
            <WrapPanel Margin="10" ItemWidth="240" ItemHeight="36">
              <Button Click="Action_MaintenanceComplete" Margin="6">Maintenance complète</Button>
              <Button Click="Action_CleanTemp"          Margin="6">Nettoyer TEMP</Button>
              <Button Click="Action_CleanBrowsers"      Margin="6">Nettoyer navigateurs</Button>
              <Button Click="Action_UpdateAll"          Margin="6">Tout mettre à jour</Button>
              <Button Click="Action_Defender"           Margin="6">Sécurité (Defender)</Button>
            </WrapPanel>
          </GroupBox>

          <!-- ======== STATUT ======== -->
          <StackPanel Margin="0,10,0,0">
            <ProgressBar x:Name="ActionProgress" Height="8" IsIndeterminate="False" Visibility="Collapsed"/>
            <TextBlock x:Name="StatusText" Text="Prêt." FontSize="13" Margin="0,6,0,0"/>
          </StackPanel>
        </StackPanel>
      </Border>
    </Grid>
  </Grid>
</Window>
