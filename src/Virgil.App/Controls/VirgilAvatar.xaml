<UserControl x:Class="Virgil.App.Controls.VirgilAvatar"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:controls="clr-namespace:Virgil.App.Controls"
             x:Name="Root"
             MinWidth="160" MinHeight="160">
    <UserControl.DataContext>
        <!-- VM par défaut si non injecté -->
        <controls:VirgilAvatarViewModel/>
    </UserControl.DataContext>

    <Grid>
        <Grid.Resources>
            <!-- Pour transformer la couleur en Brush -->
            <controls:ColorToBrushConverter x:Key="ColorToBrushConverter"/>
        </Grid.Resources>

        <!-- Visage (cercle) -->
        <Ellipse StrokeThickness="6"
                 Stroke="{Binding StrokeColor, Converter={StaticResource ColorToBrushConverter}}"
                 Fill="{Binding FaceColor, Converter={StaticResource ColorToBrushConverter}}"
                 Effect="{StaticResource DropShadowEffect}"/>

        <!-- Yeux -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition/>
                <ColumnDefinition/>
            </Grid.ColumnDefinitions>

            <!-- Œil G -->
            <Grid Grid.Column="0"
                  Margin="{Binding EyeSeparation, Converter={StaticResource EyeSeparationToMarginConverter}, ConverterParameter=left}"
                  HorizontalAlignment="Center" VerticalAlignment="Center">
                <Ellipse Width="34" Height="34" Fill="White" StrokeThickness="4" Stroke="White">
                    <Ellipse.RenderTransform>
                        <TransformGroup>
                            <!-- ouverture/fermeture : ScaleY -->
                            <ScaleTransform ScaleY="{Binding EyeOpen}" CenterX="17" CenterY="17"/>
                            <!-- inclinaison -->
                            <RotateTransform Angle="{Binding LeftEyeAngle}" CenterX="17" CenterY="17"/>
                        </TransformGroup>
                    </Ellipse.RenderTransform>
                </Ellipse>
            </Grid>

            <!-- Œil D -->
            <Grid Grid.Column="1"
                  Margin="{Binding EyeSeparation, Converter={StaticResource EyeSeparationToMarginConverter}, ConverterParameter=right}"
                  HorizontalAlignment="Center" VerticalAlignment="Center">
                <Ellipse Width="34" Height="34" Fill="White" StrokeThickness="4" Stroke="White">
                    <Ellipse.RenderTransform>
                        <TransformGroup>
                            <ScaleTransform ScaleY="{Binding EyeOpen}" CenterX="17" CenterY="17"/>
                            <RotateTransform Angle="{Binding RightEyeAngle}" CenterX="17" CenterY="17"/>
                        </TransformGroup>
                    </Ellipse.RenderTransform>
                </Ellipse>
            </Grid>
        </Grid>

        <!-- Accent LOVE (cœur au-dessus) -->
        <Path Visibility="{Binding ShowHeart, Converter={StaticResource BoolToVis}}"
              Fill="#FFEE88" Stroke="White" StrokeThickness="4"
              Stretch="Uniform"
              HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,4,4,0" Width="46" Height="42"
              Data="M 24,38 C 24,38 4,26 4,14 C 4,8 8,4 14,4 C 17,4 20,6 22,8 C 24,6 27,4 30,4 C 36,4 40,8 40,14 C 40,26 24,38 24,38 Z"/>

        <!-- Accent CAT (oreilles + moustaches) -->
        <Grid Visibility="{Binding ShowCat, Converter={StaticResource BoolToVis}}">
            <!-- oreilles -->
            <Path Fill="White" Stroke="White" StrokeThickness="2" Data="M 26,24 L 46,4 L 54,22 Z"
                  HorizontalAlignment="Left" VerticalAlignment="Top" Width="32" Height="22" Margin="8,6,0,0"/>
            <Path Fill="White" Stroke="White" StrokeThickness="2" Data="M 34,24 L 14,4 L 6,22 Z"
                  HorizontalAlignment="Right" VerticalAlignment="Top" Width="32" Height="22" Margin="0,6,8,0"/>
            <!-- moustaches -->
            <Rectangle Fill="White" Height="4" Width="32" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="6,0,0,26"/>
            <Rectangle Fill="White" Height="4" Width="32" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="6,0,0,6"/>
            <Rectangle Fill="White" Height="4" Width="32" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,6,26"/>
            <Rectangle Fill="White" Height="4" Width="32" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,6,6"/>
        </Grid>

        <!-- Accent DEVIL (cornes) -->
        <Grid Visibility="{Binding ShowDevil, Converter={StaticResource BoolToVis}}">
            <Path Fill="White" Stroke="White" StrokeThickness="2"
                  HorizontalAlignment="Left" VerticalAlignment="Top" Margin="14,4,0,0" Width="32" Height="20"
                  Data="M 4,20 C 8,8 12,4 18,4 C 16,10 14,16 4,20 Z"/>
            <Path Fill="White" Stroke="White" StrokeThickness="2"
                  HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,4,14,0" Width="32" Height="20"
                  Data="M 28,20 C 24,8 20,4 14,4 C 16,10 18,16 28,20 Z"/>
        </Grid>
    </Grid>
</UserControl>
